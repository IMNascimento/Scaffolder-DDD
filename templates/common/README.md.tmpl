# ${project_name}

> FastAPI Multi-Architecture Scaffolder â€” **${arch}** + **${orm}** on **${db}**  
> Pacote Python: **${module_name}** Â· API prefix: **${api_prefix}**

Este repositÃ³rio foi gerado pelo *foundry.py*. Ele segue o layout **src/** com um pacote Python real chamado **`${module_name}`**, garantindo imports estÃ¡veis (dev = prod) e organizaÃ§Ã£o por arquitetura e *bounded contexts* (`${contexts}`).

---

## ğŸ“¦ Estrutura (resumo)

```
${project_name}/
â”œâ”€ src/
â”‚  â””â”€ ${module_name}/
â”‚     â”œâ”€ api/                 # Entrypoints HTTP (FastAPI), rotas, DTOs
â”‚     â”œâ”€ application/         # Casos de uso, orquestraÃ§Ã£o
â”‚     â”œâ”€ core/                # Config, db, settings, logging, erros
â”‚     â”œâ”€ domain/              # Entidades, VOs, portas (ports), regras de negÃ³cio
â”‚     â”œâ”€ infrastructure/      # Adapters (repo, gateways, orm) [varia por arquitetura]
â”‚     â””â”€ __init__.py
â”œâ”€ scripts/                   # sh/bat auxiliares (dev, lint, test, migrate)
â”œâ”€ tests/                     # Testes (pytest)
â”œâ”€ .env.example               # Exemplo de variÃ¡veis de ambiente
â”œâ”€ docker-compose.yml         # (opcional) Banco e app em containers
â”œâ”€ Dockerfile                 # Build da aplicaÃ§Ã£o
â”œâ”€ pyproject.toml             # Ruff/MyPy/poetry/setuptools (conforme template)
â””â”€ README.md
```

> **ObservaÃ§Ã£o:** Dependendo da arquitetura escolhida (`${arch}`), alguns diretÃ³rios podem ter nomes levemente diferentes (ex.: `adapters/`, `infrastructure/`).

---

## ğŸ”§ PrÃ©-requisitos

- Python **3.12+**
- (Opcional) Docker + Docker Compose
- (Opcional) `make` (Linux/Mac) ou Git Bash no Windows

---

## ğŸš€ Setup rÃ¡pido (dev)

### 1) Criar e ativar o ambiente virtual
```bash
python -m venv .venv
# Linux/Mac
source .venv/bin/activate
# Windows (PowerShell)
# .venv\Scripts\Activate.ps1
```

### 2) Instalar dependÃªncias
HÃ¡ duas formas. Recomendamos **editable install** para habilitar imports estÃ¡veis do pacote `${module_name}`.

**OpÃ§Ã£o A â€” Editable install (recomendada)**
```bash
pip install -U pip
pip install -r requirements.txt
pip install -e .
```
Isso instala `${module_name}` no modo desenvolvimento. Assim, em qualquer lugar (incluindo `tests/`) vocÃª pode fazer:
```python
from ${module_name}.core.settings import Settings
```

**OpÃ§Ã£o B â€” Apenas requirements (funciona, mas menos robusta)**
```bash
pip install -U pip
pip install -r requirements.txt
# (se optar por essa, configure PYTHONPATH=./src ao rodar scripts)
```

### 3) Configurar variÃ¡veis de ambiente
Crie um `.env` a partir do exemplo e ajuste o que for necessÃ¡rio:
```bash
cp .env.example .env
```
Campos comuns (exemplo â€” pode variar por template):
```
APP_ENV=dev
API_PREFIX=${api_prefix}
DATABASE_URL=${db}://${module_name}:password@localhost:5432/${project_name}
# ou use a URL gerada pelo foundry: ${db_url}
```

### 4) (Opcional) Subir infraestrutura com Docker
```bash
docker compose up -d --build
```
O compose geralmente sobe um banco (`${db}`) e, se configurado, a app.

### 5) Criar/rodar migraÃ§Ãµes (SQLAlchemy + Alembic)
Se o template usar SQLAlchemy + Alembic:
```bash
./scripts/migrate.sh
# ou manualmente:
# alembic revision -m "init"
# alembic upgrade head
```

### 6) Rodar em modo desenvolvimento
```bash
./scripts/dev.sh
# ou
uvicorn ${module_name}.api.main:app --reload --host 0.0.0.0 --port 8000
```

Abra:
- Swagger UI: `http://localhost:8000${api_prefix}/docs`
- Redoc: `http://localhost:8000${api_prefix}/redoc`

---

## ğŸ§­ ConvenÃ§Ãµes de import

Este projeto usa **src layout** com pacote `${module_name}`. Sempre importe a partir de `${module_name}.â€¦`:
```python
from ${module_name}.domain.payment.entities import Payment
from ${module_name}.application.payment.use_cases.create_payment import CreatePayment
from ${module_name}.core.errors import NotFoundError
```
> Evite `from app.â€¦`. O gerador jÃ¡ tenta corrigir *templates* legados, mas o ideal Ã© manter `${module_name}` nos novos arquivos.

---

## ğŸ§ª Testes e cobertura

### Rodar testes
```bash
pytest -v
```

### Cobertura (threshold configurÃ¡vel no `pytest.ini`)
```bash
pytest --cov=${module_name} --cov-report=term-missing --cov-report=html
# RelatÃ³rio HTML em: htmlcov/index.html
```

---

## âœ… Qualidade (Ruff, MyPy, pre-commit)

### Lint e format
```bash
ruff check . --fix
ruff format .
```

### Tipos (MyPy)
```bash
mypy src/${module_name} tests
```

### Hooks de commit
```bash
pre-commit install
pre-commit run -a
```

---

## ğŸ§± Scripts Ãºteis

Se presentes (podem variar conforme template):

```bash
./scripts/dev.sh        # uvicorn com reload
./scripts/migrate.sh    # migraÃ§Ãµes (alembic)
./scripts/test.sh       # pytest + cobertura
./scripts/lint.sh       # ruff + mypy
./scripts/wait-for-db.sh
```

No Windows, rode via Git Bash ou adapte para `.bat/.ps1`.

---

## ğŸ§© Arquitetura & Contextos

O *foundry* suporta mÃºltiplos *bounded contexts* (ex.: `payment`, `sales`) e diferentes estilos arquiteturais:
- **DDD / Hybrid**: `domain/` com entidades/VOs/ports e `application/` para casos de uso; `infrastructure/` para adapters e persistÃªncia.
- **Hexagonal**: separaÃ§Ã£o explÃ­cita de *adapters* inbound/outbound e ports.
- **MVC**: mais direto, com camadas simplificadas.

Os contextos sÃ£o expandidos a partir de `${contexts}` no momento da geraÃ§Ã£o; arquivos de *use cases*, *entities*, *ports* e *repositories* sÃ£o criados em seus respectivos diretÃ³rios.

---

## ğŸ—„ï¸ PersistÃªncia

- **ORM**: `${orm}`
- **Banco**: `${db}`

A URL padrÃ£o Ã© inferida pelo *foundry*. VocÃª pode alterÃ¡-la em `.env`:
```
DATABASE_URL=${db}://${module_name}:password@localhost:5432/${project_name}
# exemplo para PostgreSQL (async):
# postgresql+asyncpg://postgres:postgres@localhost:5432/${project_name}
```

Se usar SQLAlchemy + Alembic, verifique o arquivo `alembic/env.py` â€” o *foundry* injeta o `target_metadata` a partir de `${module_name}.core.db` e importa os modelos por contexto.

---

## ğŸ›¡ï¸ Logs & Config

- ConfiguraÃ§Ãµes centralizadas em `${module_name}.core.settings` (Pydantic Settings).
- Logging estruturado (structlog) em `${module_name}.core.logging` (se incluÃ­do pelo template).
- ExceÃ§Ãµes comuns em `${module_name}.core.errors`.

---

## ğŸ§ª Exemplo mÃ­nimo (hello route)

> Dependendo do template, vocÃª terÃ¡ algo como:

```python
# src/${module_name}/api/main.py
from fastapi import FastAPI

app = FastAPI(title="${project_name}")

@app.get("${api_prefix}/health")
def health():
    return {"status": "ok"}
```

Rode:
```bash
uvicorn ${module_name}.api.main:app --reload
```

---

## ğŸ› ï¸ Comandos Ãºteis (cheat sheet)

```bash
# 1) Ambiente
python -m venv .venv && source .venv/bin/activate
pip install -U pip && pip install -r requirements.txt && pip install -e .

# 2) Infra (opcional)
docker compose up -d --build

# 3) MigraÃ§Ã£o (se Alembic)
alembic upgrade head

# 4) Dev server
uvicorn ${module_name}.api.main:app --reload

# 5) Qualidade
ruff check . --fix && ruff format . && mypy src/${module_name}

# 6) Testes
pytest -v --cov=${module_name} --cov-report=term-missing
```

---

## ğŸ“„ LicenÃ§a

Este projeto pode incluir um arquivo `LICENSE` conforme o template selecionado. Ajuste conforme necessÃ¡rio.

---

## ğŸ’¬ Suporte

Abra uma *issue* descrevendo problemas ou melhorias. SugestÃµes sÃ£o bem-vindas!

## ğŸ‘¤ Autor

- **Igor Nascimento** â€“ Desenvolvedor Principal â€“ [GitHub](https://github.com/IMNascimento)

## ğŸ™ Agradecimentos

- [FastAPI](https://fastapi.tiangolo.com/)  
- [SQLAlchemy](https://www.sqlalchemy.org/)  
- [Alembic](https://alembic.sqlalchemy.org/)  
- Comunidade DDD & Python por inspiraÃ§Ã£o
- SophiaLabs (https://www.sophialabs.com.br) pelo apoio ao projeto e sempre apoiar iniciativas open source!

